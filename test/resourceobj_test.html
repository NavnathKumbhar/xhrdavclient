<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Resource Object Test</title>
  <script src="../closure-library/closure/goog/base.js" type="text/javascript"></script>
  <script src="../xhrdavclientdeps.js" type="text/javascript"></script>
  <script src="utils.js" type="text/javascript"></script>
</head>
<body>
  <script type="text/javascript">
    goog.require('goog.testing.jsunit');
    goog.require('goog.debug.Console');
    goog.require('goog.debug.Logger');

    goog.require('goog.object');
    goog.require('xhrdav.lib.Resource');
    goog.require('xhrdav.lib.HttpStatus');
  </script>
  <script type="text/javascript">
    goog.debug.Console.autoInstall();
    goog.debug.Console.instance.setCapturing(true);

    var initData;
    var func;
    var httpStatus = xhrdav.lib.HttpStatus;
    var httpStatusText = xhrdav.lib.HttpStatus.text;

    // Load fixture by jsonp
    var fixtureData;
    var multistatusDironlyParseRaw = function(json) {
      fixtureData = json;
    };
    loadJson('../fixtures/multistatusDironlyParseRaw.js');

    function setUp() {
      initData = fixtureData['json'];
    }

    function tearDown() {
      initData = null;
    }

    function testCreateResource() {
      var testId = 'CreateResource';
      var logger = new goog.debug.Logger.getLogger(testId);

      var resource = new xhrdav.lib.Resource();
      assertNotNullNorUndefined('Get resource Object?', resource);
      assertTrue('xhrdav.lib.Resource?', resource instanceof xhrdav.lib.Resource);
      assertTrue('Get Row Object?', goog.object.isEmpty(resource.getRaw()));
    }

    function testCrateWithRawResource() {
      var testId = 'CrateWithRawResource';
      var logger = new goog.debug.Logger.getLogger(testId);

      var resource = new xhrdav.lib.Resource(initData);
      assertNotNullNorUndefined('Get resource Object?', resource);
      assertFalse('Get raw object?', goog.object.isEmpty(resource.getRaw()));
//alert(initData['D$response']['D$propstat']['D$sttus']);
      // href, status, resourcetype, creationdate, lastmodified, parent
      logger.config(resource.href);
      logger.config(resource.pathlist);
      assertNonEmptyString('href?', resource.href);
      assertFalse('path list count > 0?', goog.array.isEmpty(resource.pathlist));
      assertEquals('Status OK?', httpStatus.OK, resource.statuscode);
      assertEquals('ResourceType?', 'collection', resource.resourcetype);
      assertTrue('CreationDate <#Date>?', resource.creationdate instanceof Date);
      assertTrue('lastmodified <#Date>?', resource.lastmodified instanceof Date);

      // serialize
      var resource_hash = xhrdav.lib.Resource.serialize(resource);
      logger.config(resource_hash.statuscode);
      assertFalse('xhrdav.lib.Resource?',
        resource_hash instanceof xhrdav.lib.Resource);
      assertEquals('href?', resource.href, resource_hash.href);
      assertArrayEquals('path list same?',
        resource.pathlist, resource_hash.pathlist);
      assertEquals('Status OK?', resource.statuscode, resource_hash.statuscode);
      assertEquals('Content-Type?',
        resource.contenttype, resource_hash.contenttype);
    };

    /*
      Directory Json/Hash repr
      {status: 'HTTP/1.1 200 OK', statuscode: 200, statustext: 'OK', protocol: 'HTTP/1.1',
       resourcetype: 'collection', creationdate: <date>, lastmodified: <date>,
       etag: '"134fab1458-1234-fefa018070431"', contenttype: 'http/unix-directry',
       [lockdiscovery: LOCK時のプロパティ 未確定] =>{activelock: {
        locktype: 'write',
        lockscope: 'exclusive'
        depth: 0
        owner: 'Jame Smith',
        timeout: [# | Infinite],
        locktoken: {href: {opaquelocktoken: 'f81de2ad-7f3d'}},
       }
      }

      File Json/Hash repr
      {status: 'HTTP/1.1 200 OK', statuscode: 200, statustext: 'OK', protocol: 'HTTP/1.1',
       resourcetype: 'collection', creationdate: <date>, lastmodified: <date>,
       etag: '"134fab1458-1234-fefa018070431"', contenttype: 'http/unix-directry',
       [lockdiscovery: ?] <= 不明
      }
     */
  </script>
</body>
</html>
