<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Resource generator Test</title>
  <script src="../closure-library/closure/goog/base.js" type="text/javascript"></script>
  <script src="../xhrdavclientdeps.js" type="text/javascript"></script>
  <script src="utils.js" type="text/javascript"></script>
</head>
<body>
  <script type="text/javascript">
    goog.require('goog.testing.AsyncTestCase');
    goog.require('goog.testing.jsunit');
    goog.require('goog.debug.Console');
    goog.require('goog.debug.Logger');

    goog.require('goog.net.XhrManager');
    goog.require('xhrdav.lib.Client');
    goog.require('xhrdav.lib.HttpStatus');
    goog.require('xhrdav.lib.ResourceGenerator');
  </script>
  <script type="text/javascript">
    goog.debug.Console.autoInstall();
    goog.debug.Console.instance.setCapturing(true);

    // Prepare AsyncTest
    var asyncTestCase = goog.testing.AsyncTestCase.createAndInstall();
    asyncTestCase.stepTimeout = 5000;   // Wait Multi HTTP Requests in each test.
    var asyncContinue = function() {
      asyncTestCase.continueTesting();
    };

    var initDirOnlyData, initCurrDirData;
    // Load fixture by jsonp
    var fixtureDirOnlyData;
    var multistatusDironlyParseRaw = function(json) {
      fixtureDirOnlyData = json;
    };
    loadJson('../fixtures/multistatusDironlyParseRaw.js');

    var fixtureCurrDirData;
    var multistatusCurrentDirParseRaw = function(json) {
      fixtureCurrDirData = json;
    };
    loadJson('../fixtures/multistatusCurrentDirParseRaw.js');

    function setUp() {
      initDirOnlyData = fixtureDirOnlyData['json'];
      initCurrDirData = fixtureCurrDirData['json'];
    }

    function tearDown() {
      initDirOnlyData = initCurrDirData = null;
    }

    function testCreateGenerator() {
      var testId = 'CreateGenerator';
      var logger = new goog.debug.Logger.getLogger(testId);

      var generator = new xhrdav.lib.ResourceGenerator();
      assertNotNullNorUndefined('Create Instance?', generator);
    }

    function testCreateWithMixinResource() {
      var testId = 'CreateWithMixinResource';
      var logger = new goog.debug.Logger.getLogger(testId);

      var generator = new xhrdav.lib.ResourceGenerator(
        new xhrdav.lib.Resource());
      assertNotUndefined('Define resource property: href?', generator.href);
    }

    function testDestinationDir() {
      var testId = 'DestinationDir';
      var logger = new goog.debug.Logger.getLogger(testId);

      var generator = new xhrdav.lib.ResourceGenerator(
        new xhrdav.lib.Resource());
      assertTrue('Destination is empty?',
        goog.string.isEmptySafe(generator.getDestination()));
      var destPath ='/mydav/parentGen/bar';
      generator.setDestination('/mydav/parentGen/bar');
      assertNotNullNorUndefined('Set destination?', generator.getDestination());
      assertEquals('Set destpath same?', destPath, generator.getDestination());
    }

    function testSupportMethod() {
      var testId = 'SupportMethod';
      var logger = new goog.debug.Logger.getLogger(testId);

      var genKlass = xhrdav.lib.ResourceGenerator;
      assertNotUndefined('Define class method remove?', genKlass.remove);
      assertNotUndefined('Define class method copy?', genKlass.copy);
      assertNotUndefined('Define class method move?', genKlass.move);
      assertNotUndefined('Define class method rename?', genKlass.rename);
      var generator = new genKlass();
      assertNotUndefined('Define method remove?', generator.remove);
      assertNotUndefined('Define method copy?', generator.copy);
      assertNotUndefined('Define method move?', generator.move);
      assertNotUndefined('Define method rename?', generator.rename);
    }

    function testSerialize() {
      var testId = 'Serialize';
      var logger = new goog.debug.Logger.getLogger(testId);

      var genKlass = xhrdav.lib.ResourceGenerator;
      var generator = new genKlass();
      generator.href = '/foo/bar/';
      generator.status = 'HTTP/1.1 200 OK';
      var resSerializeKls = generator.serialize();
      assertTrue('same xhrdav.lib.Resource?',
        resSerializeKls instanceof xhrdav.lib.Resource);
      logger.config(goog.json.serialize(resSerializeKls));
      assertEquals('href is same?', generator.href, resSerializeKls.href);
      assertEquals('status is same?', generator.status, resSerializeKls.status);
    }

    function testLoad() {
      var testId = 'Load';
      var logger = new goog.debug.Logger.getLogger(testId);

      var genKlass = xhrdav.lib.ResourceGenerator;
      var resource = new xhrdav.lib.Resource();
      resource.href = '/foo/bar/';
      resource.status = 'HTTP/1.1 200 OK';
      var generator = new genKlass(resource);
      assertEquals('href is same?', resource.href, generator.href);
      assertEquals('status is same?', resource.status, resource.status);
    }
  </script>
</body>
</html>
