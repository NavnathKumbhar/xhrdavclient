<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>XHR Implements XMLHttpRequest#sendAsBinary extension</title>
  <script src="../closure-library/closure/goog/base.js" type="text/javascript"></script>
  <script src="../xhrdavclientdeps.js" type="text/javascript"></script>
  <script src="utils.js" type="text/javascript"></script>
  <script type="text/javascript">
    goog.require('goog.testing.AsyncTestCase');
    goog.require('goog.testing.jsunit');
    goog.require('goog.debug.Console');
    goog.require('goog.debug.Logger');
    goog.require('goog.json');

    goog.require('xhrdav.lib.XhrIoExtBinary');
    goog.require('xhrdav.lib.Client');
  </script>
</head>
<body>
  <script type="text/javascript">
    goog.debug.Console.autoInstall();
    goog.debug.Console.instance.setCapturing(true);

    // Prepare AsyncTest
    var asyncTestCase = goog.testing.AsyncTestCase.createAndInstall();
    var asyncContinue = function() {
      asyncTestCase.continueTesting();
    };

    var dav = new xhrdav.lib.Client();
    var imgFile = '../fixtures/sample.jpg';
    var parentDir = '/mydav/parentForImgUpload/';
    var httpStatus = xhrdav.lib.HttpStatus;
    var httpStatusText = xhrdav.lib.HttpStatus.text;
    var imgData = null;

    function setUp() {
//      var callbackFn = function(errors, newLoc) {
//        goog.net.XhrIo.send(imgFile, function(e) {
//          var xhr = e.target;
//          imgData = xhr.getResponse();
//        asyncContinue();
//        });
//      }
//      asyncTestCase.waitForAsync('setUp');
//      dav.mkcol(parentDir, callbackFn);
    }

    function tearDown() {
//      imgData = null;
//      asyncTestCase.waitForAsync('tearDown');
//      dav._delete(parentDir, asyncContinue);
    }

    function testCreateXhrExt() {
      var testId = 'testCreateXhrExt';
      var xhr = new XMLHttpRequest();
      assertNotNullNorUndefined('Created?', xhr);
      assertNotUndefined('Defined send?', xhr.send);
      assertNotUndefined('Defined sendAsBinary?', xhr.sendAsBinary);
    }

    function testCreateXhrIoExt() {
      var testId = 'testCreateInstance';
      var xhrIo = new xhrdav.lib.XhrIoExtBinary();
      var xhrIo2 = new goog.net.XhrIo();
      var xhr = new XMLHttpRequest();
      assertNotNullNorUndefined('Created?', xhrIo);
      assertNotUndefined('Defined send?', xhrIo.send);

      // private scope process
      xhrIo.xhr_ = xhrIo.createXhr();
      xhrIo2.xhr_ = xhrIo2.createXhr();
      assertNotEquals('Not Same Fn?', xhrIo2.xhr_.send, xhrIo.xhr_.send);
      assertEquals('Same Fn?', xhr.sendAsBinary, xhrIo.xhr_.send);
    }

//    function testImgUpload() {
//      var testId = 'testImgUpload';
//      var logger = goog.debug.Logger.getLogger(testId);
//      var uploadPath = goog.string.path.normalizePath(
//        goog.string.path.join(parentDir, testId + '.jpg'));
//      xhrdav.lib.XhrIoExtBinary.send(uploadPath, function(e) {
//        var xhr = e.target;
//        console.log(testId);
//        console.log(xhr);
//      }, 'PUT', imgData);
//    }
  </script>
</body>
</html>
