<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>TestXHR</title>
  <script src="../closure-library/closure/goog/base.js" type="text/javascript"></script>
  <script src="deps.js" type="text/javascript"></script>
  <script type="text/javascript">
    goog.require('goog.testing.AsyncTestCase');
    goog.require('goog.testing.jsunit');
    goog.require('goog.debug.Logger');
  </script>
</head>
<body>
  <script type="text/javascript">
    goog.require('webdav.TestApp');
  </script>
  <script type="text/javascript">
    // Prepare AsyncTest
    var asyncTestCase = goog.testing.AsyncTestCase.createAndInstall();

    function testList() {
      var testId = 'List';

      var dir = '/mydav/';
      var logger = goog.debug.Logger.getLogger(testId);
      var asyncContinue = function() { asyncTestCase.continueTesting(); };
      var assertList = function(statusCode, statusText) {
        assertEquals('StatusCode?', statusCode, 207);
        assertEquals('StatusText?',
          goog.string.trim(statusText), 'Multi-Status');
      };

      asyncTestCase.waitForAsync(testId);
      var request = webdav.TestApp.requestAndListen(
        logger, assertList, asyncContinue);
      webdav.TestApp.listDir(request, dir);
    }

    function testCreateAndDeleteDir() {
      var testId = 'CreateAndDeleteDir';

      var dir = '/mydav/foo/';
      var logger = goog.debug.Logger.getLogger(testId);
      var asyncContinue = function() { asyncTestCase.continueTesting(); };
      var assertDelete = function(statusCode, statusText) {
        assertEquals('StatusCode?', statusCode, 204);
        assertEquals('StatusText?', goog.string.trim(statusText), 'No Content');
      };
      var assertCreate = function(statusCode, statusText) {
        assertEquals('StatusCode?', statusCode, 201);
        assertEquals('StatusText?', goog.string.trim(statusText), 'Created');
      };

      asyncTestCase.waitForAsync(testId + 'Prepare');
      var request = webdav.TestApp.requestAndListen(
        logger, assertCreate);
      webdav.TestApp.createDir(request, dir);
      asyncTestCase.waitForAsync(testId);
      request = webdav.TestApp.requestAndListen(
        logger, assertDelete, asyncContinue);
      webdav.TestApp.deleteDir(request, dir);
    }
  </script>
</body>
</html>
