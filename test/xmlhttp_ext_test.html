<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>XMLHttpRequest Extension</title>
  <script src="../closure-library/closure/goog/base.js" type="text/javascript"></script>
  <script src="../xhrdavclientdeps.js" type="text/javascript"></script>
  <script src="utils.js" type="text/javascript"></script>
  <script type="text/javascript">
    goog.require('goog.testing.AsyncTestCase');
    goog.require('goog.testing.jsunit');
    goog.require('goog.debug.Console');
    goog.require('goog.debug.Logger');
    goog.require('goog.json');
    goog.require('xhrdav.lib.Config');

    goog.require('xhrdav.lib.XmlHttp');
    goog.require('xhrdav.lib.HttpStatus');
    goog.require('goog.userAgent');
    goog.require('goog.userAgent.product');
    goog.require('goog.userAgent.product.isVersion');
    goog.require('xhrdav.lib.Client');
  </script>
</head>
<body>
  <script type="text/javascript">
    // Prepare AsyncTest
    var asyncTestCase = goog.testing.AsyncTestCase.createAndInstall();
    var asyncContinue = function() {
      asyncTestCase.continueTesting();
    };
    var dav = new xhrdav.lib.Client();
    var parentDir = '/mydav/xmlhttp/';

    function setUp() {
      console.log(goog.userAgent.product);
      xhrdav.lib.Config.logging({
        'chrome?': goog.userAgent.product.CHROME,
        'IE?': goog.userAgent.product.IE,
        'firefox?': goog.userAgent.product.FIREFOX});
      asyncTestCase.waitForAsync('setUp');
      dav.mkcol(parentDir, asyncContinue);
    }

    function tearDown() {
      asyncTestCase.waitForAsync('tearDown');
      dav._delete(parentDir, asyncContinue);
    }

    function testExt() {
      var xhr = new XMLHttpRequest();
      var httpStatus = xhrdav.lib.HttpStatus;
      var path = parentDir + 'foo.txt';
      var content = 'foo bar';
      var display = function() {
        if (xhr.readyState == 4) {
            xhrdav.lib.Config.logging({
              'statuscode': xhr.status,
              'response': xhr.respnoseText});
            assertEquals('status created?', httpStatus.CREATED, xhr.status);
            console.log(xhr.getResponseHeader('location'));
            console.log(xhr.getResponseHeader('content-type'));
            console.log(xhr.getAllResponseHeaders());
            asyncContinue();
        }
      };

      assertNotNullNorUndefined('Create xhr?', xhr);
      assertNotUndefined('Defined sendAsBinary?', xhr.sendAsBinary);


      asyncTestCase.waitForAsync('testExt');

      xhr.open('PUT', path);
      xhr.onreadystatechange = display;
      xhr.sendAsBinary(content);
    }
  </script>
</body>
</html>
